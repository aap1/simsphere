program test_prfile
  use simsphere_mod
  implicit none

  integer :: i

  real, dimension(51), parameter :: u_fine_exp = (/1.00000000,0.800000012,    &
        0.600000024,0.399999976,0.199999988,0.00000000,0.00000000,0.00000000, &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000/)
  real, dimension(51), parameter :: v_fine_exp = (/1.00000000,0.800000012,    &
        0.600000024,0.399999976,0.199999988,0.00000000,0.00000000,0.00000000, &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000/)
  real, dimension(51), parameter :: t_fine_exp = (/1.00000000,0.800000012,    &
        0.600000024,0.399999976,0.199999988,0.00000000,0.00000000,0.00000000, &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000/)
  real, dimension(51), parameter :: q_fine_exp = (/1.00000000,0.800000012,    &
        0.600000024,0.399999976,0.199999988,0.00000000,0.00000000,0.00000000, &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,    &
        0.00000000/)

   CF = 9.19953891E-05
   OTEMP = 295.149994
   VGD(5) = 8.41951942
   VGD(3) = 8.43165302
   VGD(1) = 8.44378662
   UGD(5) = 13.0658665
   UGD(3) = 9.05783463
   UGD(1) = 5.04980326

  NTRP = 10
  VGS = 10.0
  UGS = 10.0
  ud = 1.0
  vd = 1.0
  VGD(NTRP) = 1.0
  UGD(NTRP) = 1.0

  ud = 0.0
  vd = 0.0
  ud(1) = 1.0
  vd(1) = 1.0
  ud(3) = 1.0
  vd(3) = 1.0
  do i = 5,NTRP
    ud(i) = 1.0
    vd(i) = 1.0
  end do
  td(1) = 1.0
  qd(1) = 1.0

  call prfile

  if (all(u_fine == u_fine_exp)) then
    write(*,*) 'u_fine OK'
  else
    write(*,*) u_fine
  end if
  if (all(v_fine == v_fine_exp)) then
    write(*,*) 'v_fine OK'
  else
    write(*,*) v_fine
  end if
  if (all(t_fine == t_fine_exp)) write(*,*) 't_fine OK'
  if (all(q_fine == q_fine_exp)) write(*,*) 'q_fine OK'
  if (eq(AWIND,1.41421354)) then
    write(*,*) 'AWIND OK'
  else 
    write(*,*) AWIND
  end if


end program test_prfile
